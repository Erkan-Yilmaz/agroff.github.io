<!DOCTYPE html>
<html>
<head>
    <title>Understanding PoSV</title>

    <link rel="stylesheet" type="text/css" href="css/Entypo/entypo.css">
    <link rel="stylesheet" type="text/css" href="css/posv.css">

    <link rel="shortcut icon" href="img/icon.png" />

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="js/Chart.js"></script>
    <script type="text/javascript" src="js/init.js"></script>
    <script type="text/javascript" src="js/BasicCalculatorView.js"></script>
    <script type="text/javascript" src="js/BasicCalculator.js"></script>
    <script type="text/javascript" src="js/WeightChartView.js"></script>
    <script type="text/javascript" src="js/ThetaChartView.js"></script>
    <script type="text/javascript" src="js/CoinWeight.js"></script>
    <script type="text/javascript" src="js/Expandables.js"></script>
    <script type="text/javascript" src="js/controllers.js"></script>
</head>
<body>


<div id="mainColumnContainer">

    <h1>
        Understanding PoSV
    </h1>

    <p>
        In its most basic form, we can think of PoSV simply as compounding interest. It was designed to offer 5-6%
        interest, compounding every time you mint (produce new coins). For a rough approximation of returns, we will calculate the returns
        for 5% interest compounded daily.
    </p>

    <div class="header">
        <h2>
            <img src="http://i.imgur.com/8z5IK9G.png" alt="Reddcoin Icon" class="reddcoinIcon" />
            Reddcoin Stake Calculator
        </h2>

    </div>
    <div class="mainContainer">
        <input type="text" id="initialRdd" />
        <button id="calculateButton">Calculate</button>
        <div id="errorMessage">^ This should be a number.</div>
        <div id="results">
            <p>Enter your total Reddcoin above to see your stake returns.</p>
        </div>
    </div>

    <p class="small">
        I'm not positive this is accurate.
        If it's wrong please fix it and/or blame hoppi.
    </p>

    <h2>
        Isn't it a bit more complicated than that?
    </h2>

    <p>
        It is of course. Since your interest compounds every time you mint, we first need to understand when, or how
        often, you mint.
    </p>

    <p>
        It's easiest to think about this in terms of a lottery. Everyone with reddcoins has many "lottery tickets."
        Approximately every minute, one lottery ticket is chosen, and whoever wins gets awarded newly created coins.
    </p>

    <p>
        If you have reddcoins in your wallet, you have some lottery tickets. Whoever has the most lottery tickets has
        the best chance of winning. To enter the lottery just make sure your wallet is <i>staking</i>, and it will enter
        the drawing for you every minute.
    </p>
    <p>
        Before we can understand how many tickets each person gets, we'll need to review
        a few important concepts.
    </p>

    <hr>

	<h3>
		What is <i>staking</i> ?
	</h3>
	
	<p>
		Staking is the process your wallet uses to validate transactions and award you with coins. When your wallet is
        staking, it is checking transactions to make sure everyone who sends coins actually owned those coins and had the
        right to transfer them. If most of the wallets online agree that a transaction is valid, then it gets accepted
        by the network. This concept of consensus is essential to all digital currencies, and is what keeps Reddcoin secure.
	</p>


    <div class="tip" title="Tip: How to Stake">
        <p>
            In order to stake, ensure that your wallet is encrypted and unlocked. By keeping your wallet open, it will
            stake automatically.
        </p>
        <p>
            When you encrypt your wallet, make sure to use a strong password that you will never
            forget. You cannot recover your password or coins if you forget your password.
        </p>
    </div>

	<p>
        As a reward for keeping the network secure, every minute one person is chosen to receive some interest on the
        coins they own. Whoever has the most "lottery tickets" has the best chance of winning the award.
	</p>
    <p>
        In Reddcoin terms, your lottery tickets are referred to as your <i>weight</i>, and your weight is a product
        of <i>coinage</i>.
    </p>

	
	<h3>
		What is <i>coinage</i> ?
	</h3>
	
	<p>
		Quite simply, <i>coinage</i> is the age of your coins. Imagine you get a new wallet and start out with zero coins.
        On Monday, your friend sends you 5,000 coins. On Wednesday, you decide to buy 10,000 more coins and withdraw them
        to your wallet.
	</p>

	<p>
        Assuming it's Thursday, you'll have two groups of coins. The first group of 5,000 has 3 days of coin age,
        and the second group of 10,000 coins has 1 day of coin age.
	</p>

	<p>
        When coins are sent to another address or successfully stake (generate interest), their coin age is reset.
	</p>

    <div class="info" title="More Info: Staking by Group">
        <p>
            It's important to recognize that staking happens in groups. So, following our example above, if your first
            group of 5,000 coins stakes, you'll get an interest payed on those 5,000 coins, not your entire balance of
            15,000 coins.
        </p>
        <p>
            Additionally, coin age will be reset on your group of 5,000, but coinage on your second group of 10,000 will
            continue to grow until they stake or are used in a transaction.
        </p>
    </div>

    <hr>

	<h2>
		What is the <i>network weight</i>, <i>total weight</i>, and <i>expected time</i> until next reward ?
	</h2>

    <div class="tip" title="Tip: View Weight Information">
        <p>
            In your reddcoin wallet, you can view weight information at the bottom right of your wallet if you let your
            mouse hover over the green arrow which indicates that your wallet is currently staking.
        </p>
    </div>
	
	<p>
		According to the reddcoin protocol, every minute there's a lottery going on, 
		which will result in a block being discovered.
	</p>

    <div class="info" title="More Info: What's a Block?">
        <p>
            TODO: Brief description of block.
        </p>
    </div>
	
	<p>
		The <i>network weight</i> can be understood as the number of tickets available for this lottery. 
		In practice the network weight is the sum of "coinage" of all the coins which are staking at this moment accross 
		the entire network. 
		Let's call this number NW (for "network weight").
	</p>
	
	<p>
		Now your <i>total weight</i> is the number of tickets <i>you</i> own which allow you to participate in this lottery. 
		It is calculated by summing up all the coinage of the coins which are staking in your wallet. 
		Let's call this number TW (for "total weight").
	</p>

	<p>	
		Now you need to know that this lottery is <i>fair</i> in the sense that each "ticket" is equally likely to win 
		on the next round. The details by which the winner is found is internal to the protocol implementation and it 
		is not necessary to explain it here. 
	</p>
	
	<p>
		That being said, since different participants own different number of 
		those tickets, the more of them you own, the quicker you can expect to be a winner, this is the <i>expected time</i> 
		until your next reward. Of course the lottery is random so nothing is 100% certain. It could effectively take less time 
		(if you're lucky) or more time (if you're less lucky :P) than the expected time for your to effectively win. But in the long
		run, those differences average out and you would see that the expected time is pretty accurate (as long as you keep your
		wallet online 24/7).
	</p>
	
	<p>	
		To be more mathematically specific, on each minute round you have a chance TW/TN to be the lucky winner. It is
		a simple result that as a consequence the expected time to be a winner is TN/TW minutes. 
	</p>	
		
	<p>
		Just to put things back in the context of posv, winning here means discovering a block which will not only award you 
		those precious RDD but will also validate the most recent transactions for the network. 
		That's how you get rewarded for providing a useful service to the community!
	</p>	
		
	<p>
		Let's now see how these things work in practice. Let's assume that right now the network weight is about 13B (13,000,000,000)
		and that your total weight is 100m (100,000,000). According to what we explained above the expected time will be
	</p>
	<p>
		13B/100m = 130minutes
	</p>
	
	<p>
		so in expectation to get a reward, it would take you about 2hrs in that case. Check it with your wallet and see
		if the formula works!
	</p>

    <h2>
        So how is weight calculated?
    </h2>

    <p>
        The calculation of coin weight is the core of PoSV. Like traditional PoS, the weight is a product of total coins
        (stake) and the average age of those coins. In contrast to traditional PoS, which calculates weight as a linear
        product of age, PoSV uses an algorithm where new coins gain weight quickly, and old coins gain weight increasingly
        slowly. This is how PoSV offers a big incentive to be active.
    </p>

    <p>
        To see the PoSV algorithm in action, we can look at a graph of coin weight over age.
    </p>

    <select id="weightGraphAge">
        <option value="3">3 Day Coin Age</option>
        <option value="7">7 Day Coin Age</option>
        <option value="10">10 Day Coin Age</option>
        <option value="31">30 Day Coin Age</option>
        <option value="90">90 Day Coin Age</option>
        <option value="120">120 Day Coin Age</option>
        <option value="360">365 Day Coin Age</option>
    </select>

    <canvas id="weightChart" width="650" height="400"></canvas>

    <p>
        For the first week, you can see that coin weight is a linear function of coin age that grows faster than POS. 
        On the other hand even though coins continue to accrue weight with time, they do a slower and slower pace
        compared to POS.
    </p>
    
	<p>
		In order to better visualise the relative speed at which POSV and POS accrue weight for their coisn, 
		the next graph shows the <i>ratio</i> of POSV to POS weights. The peak of 1.2 means that at
		1 week, the coins which stake in the POSV wallet accrue weight 20% <i>faster</i> than their POS counterpart.
	</p>
	
	<p>
		On the other hand after 2 weeks the POSV coins start to accrue weight <i>slower</i> than POS. This is why it is
		said that POSV encourages staking over a relatively short period of time compared to POS.
	</p>

    <select id="thetaGraphAge">
        <option value="3">3 Day Coin Age</option>
        <option value="7">7 Day Coin Age</option>
        <option value="10">10 Day Coin Age</option>
        <option value="31">30 Day Coin Age</option>
        <option value="90">90 Day Coin Age</option>
        <option value="120">120 Day Coin Age</option>
        <option value="360">365 Day Coin Age</option>
    </select>

    <canvas id="thetaChart" width="650" height="400"></canvas>


    <p class="small">
        Chart rendered with an adapted version of the
        <a href="https://github.com/reddcoin-project/reddcoin/blob/master/src/kernel.cpp#L73" target="_blank">
            weight algorithm from reddcoin's source.
        </a>

    </p>

    <h2>
        How much do I earn when I mint?
    </h2>


    <p>
        TODO: Fill this in (after figuring out the answer).
    </p>

    <h2>
        Putting it all together
    </h2>

    <p>
        TODO: Write a simulator that will simulate a year of staking with a given initial coin value and given
        constant network weight.
    </p>

</div>



<script type="text/html" id="resultRowTemplate">
    <div class="resultText">
        Estimated ${label} gain:
    </div>
    <div class="resultAmount">
        ${amount} RDD
    </div>
    <hr class="clear" />
</script>

</body>
</html>